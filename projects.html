<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projects - Personal Site</title>
    <link href="style.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body class="theme-black">
    <div class="container">
        <header></header>
        <div class="main-content">
            <main>
                <section>
                    <div class="page-header">
                        <h3>MY PROJECTS</h3>
                        <p>Here are some of the projects I've worked on. Click on any of them to learn more.</p>
                    </div>
                    <div class="grid-container" id="project-grid">
                        <p>Loading projects...</p>
                    </div>
                </section>
            </main>
            <aside>
                <div class="sidebar-nav">
                    <nav>
                        <a href="index.html">HOME</a>
                        <a href="projects.html">PROJECTS</a>
                        <a href="blog.html">BLOG</a>
                        <a href="contact.html">CONTACT</a>
                    </nav>
                </div>
                <div class="widget" style="margin-top: 1.5em;">
                    <h4>SEARCH PROJECTS</h4>
                    <form class="search-widget">
                        <input type="search" placeholder="Enter keywords...">
                        <button type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
                    </form>
                </div>
                <div class="widget">
                    <h4>FEATURED PROJECT</h4>
                    <div class="featured-item" id="featured-project-widget">
                        <p>Loading...</p>
                    </div>
                </div>
            </aside>
        </div>
        <footer>
            <div class="footer-content">
                <p>&copy; 2025 Your Name. All rights reserved.</p>
                <div class="theme-selector">
                    <span>Theme:</span>
                    <span class="theme-button" data-theme="theme-green"></span>
                    <span class="theme-button" data-theme="theme-blue"></span>
                    <span class="theme-button" data-theme="theme-amber"></span>
                    <span class="theme-button" data-theme="theme-red"></span>
                    <span class="theme-button" data-theme="theme-black"></span>
                </div>
            </div>
        </footer>
    </div> 
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- Universal Functions ---

            async function loadFeaturedProject() {
                const container = document.getElementById('featured-project-widget');
                if (!container) return;
                try {
                    const response = await fetch('projects.json');
                    const projects = await response.json();
                    const featured = projects.find(p => p.featured === true);
                    if (featured) {
                        container.innerHTML = `
                            <a href="project_template.html?slug=${featured.slug}">
                                <h5>${featured.title}</h5>
                                <p>${featured.summary}</p>
                            </a>
                        `;
                    } else {
                        container.innerHTML = `<p>No featured project selected.</p>`;
                    }
                } catch (error) {
                    container.innerHTML = `<p>Could not load featured project.</p>`;
                }
            }

            function setupThemeSwitcher() {
                const themeButtons = document.querySelectorAll('.theme-button');
                const body = document.body;
                const themeClasses = ['theme-green', 'theme-blue', 'theme-amber', 'theme-red', 'theme-black'];
                const savedTheme = localStorage.getItem('selectedTheme') || 'theme-black';
                body.classList.remove(...themeClasses);
                body.classList.add(savedTheme);
                themeButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const theme = button.dataset.theme;
                        body.classList.remove(...themeClasses);
                        body.classList.add(theme);
                        localStorage.setItem('selectedTheme', theme);
                    });
                });
            }

            // --- Page-Specific Functions ---

            async function loadProjects() {
                const grid = document.getElementById('project-grid');
                try {
                    const response = await fetch('projects.json');
                    const projects = await response.json();
                    grid.innerHTML = '';
                    projects.forEach(project => {
                        const projectElement = document.createElement('a');
                        projectElement.href = `project_template.html?slug=${project.slug}`;
                        projectElement.className = 'grid-item';
                        projectElement.innerHTML = `
                            <div class="grid-item-content">
                                <h5>${project.title}</h5>
                                <p>${project.summary}</p>
                            </div>
                        `;
                        grid.appendChild(projectElement);
                    });
                } catch (error) {
                    grid.innerHTML = '<p>Could not load projects.</p>';
                }
            }
            
            // --- NEW: Search Functionality ---
            function setupSearch() {
                const searchForm = document.querySelector('.search-widget');
                const searchInput = searchForm.querySelector('input[type="search"]');
                const projectItems = document.querySelectorAll('#project-grid .grid-item');
                
                if (!searchForm) return;

                searchForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const keyword = searchInput.value.trim().toLowerCase();
                    projectItems.forEach(item => {
                        const text = item.textContent.toLowerCase();
                        if (text.includes(keyword)) {
                            item.style.display = 'flex'; // Use 'flex' since .grid-item is display: flex
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            }

            // --- Execution ---
            
            setupThemeSwitcher();
            loadFeaturedProject();
            
            // Load the main grid, and ONLY AFTER it's done, set up the search
            loadProjects().then(() => {
                setupSearch();
            });
        });
    </script>
</body>
</html>