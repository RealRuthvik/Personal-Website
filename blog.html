<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog - Personal Site</title>
    <link href="style.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body class="theme-black">

    <div class="container">
        <header></header>
        <div class="main-content">
            <main>
                <section>
                    <div class="page-header">
                        <h3>BLOGS</h3>
                        <p>A collection of my thoughts on technology, design, and everything in between.</p>
                    </div>
                    
                    <div class="grid-container" id="blog-grid">
                        <p>Loading posts...</p>
                    </div>
                </section>
            </main>

            <aside>
                <div class="sidebar-nav">
                    <nav>
                        <a href="index.html">HOME</a>
                        <a href="projects.html">PROJECTS</a>
                        <a href="blog.html">BLOG</a>
                        <a href="contact.html">CONTACT</a>
                    </nav>
                </div>
                <div class="widget" style="margin-top: 1em;">
                    <h4>SEARCH BLOG</h4>
                    <form class="search-widget">
                        <input type="search" placeholder="Enter keywords...">
                        <button type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
                    </form>
                </div>
                <div class="widget">
                    <h4>FEATURED BLOG</h4>
                    <div class="featured-item" id="featured-blog-widget">
                        <p>Loading...</p>
                    </div>
                </div>
            </aside>
        </div>

        <footer>
            <div class="footer-content">
                <p>&copy; 2025 Your Name. All rights reserved.</p>
                <div class="theme-selector">
                    <span>Theme:</span>
                    <span class="theme-button" data-theme="theme-green"></span>
                    <span class="theme-button" data-theme="theme-blue"></span>
                    <span class="theme-button" data-theme="theme-amber"></span>
                    <span class="theme-button" data-theme="theme-red"></span>
                    <span class="theme-button" data-theme="theme-black"></span>
                </div>
            </div>
        </footer>
    </div> 
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            async function loadFeaturedBlog() {
                const container = document.getElementById('featured-blog-widget');
                if (!container) return;

                try {
                    const response = await fetch('blogs.json');
                    const blogs = await response.json();
                    const featured = blogs.find(b => b.featured === true);

                    if (featured) {
                        container.innerHTML = `
                            <a href="blog_template.html?slug=${featured.slug}">
                                <h5>${featured.title}</h5>
                                <p>${featured.summary}</p>
                            </a>
                        `;
                    } else {
                        container.innerHTML = `<p>No featured blog selected.</p>`;
                    }
                } catch (error) {
                    container.innerHTML = `<p>Could not load featured blog.</p>`;
                }
            }

            function setupThemeSwitcher() {
                const themeButtons = document.querySelectorAll('.theme-button');
                const body = document.body;
                const themeClasses = ['theme-green', 'theme-blue', 'theme-amber', 'theme-red', 'theme-black'];
                const savedTheme = localStorage.getItem('selectedTheme') || 'theme-black';
                body.classList.remove(...themeClasses);
                body.classList.add(savedTheme);

                themeButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const theme = button.dataset.theme;
                        body.classList.remove(...themeClasses);
                        body.classList.add(theme);
                        localStorage.setItem('selectedTheme', theme);
                    });
                });
            }

            async function loadBlogPosts() {
                const grid = document.getElementById('blog-grid');
                try {
                    const response = await fetch('blogs.json');
                    const posts = await response.json();
                    grid.innerHTML = ''; 

                    posts.forEach(post => {
                        const postElement = document.createElement('a');
                        postElement.href = `blog_template.html?slug=${post.slug}`;
                        postElement.className = 'grid-item';

                        postElement.innerHTML = `
                            <div class="grid-item-content">
                                <h5>${post.title}</h5>
                                <p class="grid-item-meta">${post.date}</p>
                                <p>${post.summary}</p>
                            </div>
                        `;
                        grid.appendChild(postElement);
                    });
                } catch (error) {
                    grid.innerHTML = '<p>Could not load blog posts.</p>';
                }
            }
            
            function setupSearch() {
                const searchForm = document.querySelector('.search-widget');
                if (!searchForm) return;

                const searchInput = searchForm.querySelector('input[type="search"]');
                const blogItems = document.querySelectorAll('#blog-grid .grid-item');
                
                searchForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const keyword = searchInput.value.trim().toLowerCase();
                    blogItems.forEach(item => {
                        const text = item.textContent.toLowerCase();
                        if (text.includes(keyword)) {
                            item.style.display = 'flex'; // Use 'flex' since .grid-item is display: flex
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            }

            // --- Execution ---
            
            setupThemeSwitcher();
            loadFeaturedBlog();
            
            // Load the main grid, then set up the search functionality
            loadBlogPosts().then(() => {
                setupSearch();
            });
        });
    </script>
</body>
</html>